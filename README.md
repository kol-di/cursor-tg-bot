# cursor-tg-bot

## Настройка и запуск

Что бы создать и запустить свою копию бота нужно:

1) Скачать себе репозиторий
```linux
git init
git pull https://github.com/kol-di/cursor-tg-bot.git
```

2) Создать нового бота через BotFather, настроить быстрые команды (см. "Настройка быстрых команд")

3) Добавить данные в файл config.ini
    
    1. Взять свои API_ID и API_HASH в API Development Tools Телеграма

    2. Взять BOT_TOKEN вашего нового бота через BotFather

    3. Придумать свой ACCESS_CODE. Это пароль, который нжно будет вводить всем пользователям бота при первом запуске

4) Установить зависимости

```linux
pip install requirements.txt
```

5) Если вам нужен исполняемый файл, например для запуска бота через планировщик (Опционально) 

```linux
pyinstaller main.spec
```

Команда создаст новую папку `dist`, где лежит исполняемый файл `dist/main/main.exe`. Папку можно целиком переносить в удобное расположение. В процессе работы программа будет создавать временные файлы по пути `dist/main`

6) Запускать напрямую исполняемый файл или

```linux
python main.py
```

## Как отправлять боту отчеты

Бот ожидает появления данных для отчетов в папках `reports_*` в формате `.csv`. Для каждого отчета своя папка. При появлении файла в папке он разошлет отчет всем подписанным пользователям. Папки создаются автоматически при запуске бота в одном каталоге с исполняемым файлом или `main.py`.

## Сохранение доступов пользователей

Бот периодически обновляет данные об авторизованных пользователях и их подпсках в файле `user_access_dup.json`. При перезапуске бота он загрузит последние данные из этого файла. 

Если вы хотите перезапустить бота без потери последних данных, не убивайте процесс, а прервите его. (`ctrl+C` на Windows, `cmd+C` на Mac).

## Настройка быстрых команд

Если вы создали свою копию бота, для удобства стоит настроить быстрые команды:

```
enable - Включить бота
add_remove_subscription - Добавить или убрать рассылку
```

Это можно сделать через BotFather или напрямую через API Телеграма:
```bash
curl -d \
'{"commands": [{"command": "enable", "description": "Включить бота"},{"command": "add_remove_subscription", "description": "Добавить или убрать рассылку"}]}' \
-X POST https://api.telegram.org/bot<BOT_TOKEN> (https://api.telegram.org/bot<BOT_TOKEN>/setMyCommands)/setMyCommands
```
**Важно!** Задавать команды таким образом стоит только при первом запуске бота, когда пользователи еще не подключены. Если сделать это после, то команды не будут отображаться у пользователей, которые начали диалог с ботом ранее. Это чинится перезапуском бота со стороны пользователя.